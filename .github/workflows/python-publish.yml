name: Upload Python Package

on:
  pull_request:
    branches:
      - master
  push:
    branches:
      - master

permissions:
  contents: read

jobs:
  publish-pypi:
        name: upload release to PyPI
        runs-on: ubuntu-latest
        environment: pull_request
        permissions:  
          id-token: write
        steps:
           - uses: actions/checkout@v4
           - name: Install dependencies
             run: |
                python -m pip install --upgrade pip
                pip install setuptools wheel twine
           - name: build dist
             run: |
               python setup.py sdist bdist_wheel
           - name: Publish package distributions to PyPI
             uses: pypa/gh-action-pypi-publish@release/v1
             with:
               user: __token__
               password: ${{ secrets.PYPI_TOKEN }}
               packages-dir: dist/
               repository-url: https://test.pypi.org/legacy/
               skip-existing: true
